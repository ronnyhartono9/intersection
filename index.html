<html>
    <meta name="theme-color"content="chocolate"/>
    <meta name="viewport"content="width=device-width,initial-scale=1"> 
 <head>
     <style>
        .dot{
            height: 10px;
            width: 10px;
            background-color: #bbb;
            border-radius: 50%;
            display: inline-block;
            cursor: pointer;
        }
     </style>
    <script type="text/javascript">
        const numSteps = 20.0;
        let boxElement;let gel; let ix;let jx; let kx;
        let prevRatio = 0.0;
        let increasingColor = "rgba(40, 40, 190, ratio)";
        let decreasingColor = "rgba(190, 40, 40, ratio)";
        const ratios = [0, 0, 0, 0, 0];
     
        window.addEventListener("load", (event) => {
            boxElement = document.querySelector("#g"); 
            gel = document.querySelector("#h");

            ix = document.querySelector("#ii");
            jx = document.querySelector("#jj");
            kx = document.querySelector("#kk");  
        createObserver();
        }, false);

        function createObserver() {
            let observer; let gobserver;
                let ixerver;let jxerver;let kxerver;

                    let options = {
                        root: null,
                        rootMargin: "0px",
                        threshold: buildThresholdList()
                    };
                    let options2 = {
                        root: null,
                        rootMargin: "0px",
                        threshold: buildThresholdList()
                    };
                    let options3 = {
                        root: null,
                        rootMargin: "0px",
                        threshold: buildThresholdList()
                    };
                    let options4 = {
                        root: null,
                        rootMargin: "0px",
                        threshold: buildThresholdList()
                    };
                    let options5 = {
                        root: null,
                        rootMargin: "0px",
                        threshold: buildThresholdList()
                    };

            observer = new IntersectionObserver(handleIntersect, options);
            observer.observe(boxElement);

            gobserver = new IntersectionObserver(handleIntersect2, options2);
            gobserver.observe(gel);

            ixerver = new IntersectionObserver(handleIntersect3, options3);
            ixerver.observe(ix);

            jxerver = new IntersectionObserver(handleIntersect4, options4);
            jxerver.observe(jx);

            kxerver = new IntersectionObserver(handleIntersect5, options5);
            kxerver.observe(kx);
        }

        function buildThresholdList() {
            let thresholds = [];
            let numSteps = 20; 
            for (let i=1.0; i<=numSteps; i++) {
                let ratio = i/numSteps;
                thresholds.push(ratio);
            } 
            thresholds.push(0);
            return thresholds;
        }

        function handleIntersect(entries, observer) {
            entries.forEach((entry) => {
                if (entry.intersectionRatio > prevRatio) {
                entry.target.style.backgroundColor = increasingColor.replace("ratio", entry.intersectionRatio); 
                } else {
                entry.target.style.backgroundColor = decreasingColor.replace("ratio", entry.intersectionRatio);
                }  ratios[0] = entry.intersectionRatio;
                prevRatio = entry.intersectionRatio;
            });
        }

        function handleIntersect2(entries, observer) {
            entries.forEach((entry) => {
                if (entry.intersectionRatio > prevRatio) {
                entry.target.style.backgroundColor = increasingColor.replace("ratio", entry.intersectionRatio); 
                } else {
                entry.target.style.backgroundColor = decreasingColor.replace("ratio", entry.intersectionRatio);
                } ratios[1] = entry.intersectionRatio;
                prevRatio = entry.intersectionRatio;
            });
        }

        function handleIntersect3(entries, observer) {
            entries.forEach((entry) => {            
                if (entry.intersectionRatio > prevRatio) {
                entry.target.style.backgroundColor = increasingColor.replace("ratio", entry.intersectionRatio); 
                } else {
                entry.target.style.backgroundColor = decreasingColor.replace("ratio", entry.intersectionRatio);
                } ratios[2] = entry.intersectionRatio;
                prevRatio = entry.intersectionRatio;
            });
        } 

        function handleIntersect4(entries, observer) {
            entries.forEach((entry) => {
                if (entry.intersectionRatio > prevRatio) {
                entry.target.style.backgroundColor = increasingColor.replace("ratio", entry.intersectionRatio); 
                } else {
                entry.target.style.backgroundColor = decreasingColor.replace("ratio", entry.intersectionRatio);
                } ratios[3] = entry.intersectionRatio;
                prevRatio = entry.intersectionRatio;
            });
        }

        function handleIntersect5(entries, observer) {
            entries.forEach((entry) => {
                if (entry.intersectionRatio > prevRatio) {
                entry.target.style.backgroundColor = increasingColor.replace("ratio", entry.intersectionRatio); 
                } else {
                entry.target.style.backgroundColor = decreasingColor.replace("ratio", entry.intersectionRatio);
                } ratios[4] = entry.intersectionRatio;
                prevRatio = entry.intersectionRatio;
            });
        }  

        var p;
        const divs = ["r1", "r2", "", " ", " "];        
        const kotaks = ["g", "h", "ii", "jj", "kk"];
        function ketarik(){
             document.getElementById('hope').style.left =  document.getElementById('thope').rows[0].cells[1].offsetWidth *  ratios.indexOf( Math.max(...ratios) ) +"px";
             document.getElementById('hope').scrollIntoView();
        }
    </script>
 </head> 
 <body>    
     <a onclick="ketarik()">tombol</a>
     <div id="awak" style="  overflow: scroll; scroll-behavior: smooth;   width: 100%; height: 95%;">
        <div id="panel" style=" height: 100%;">
            <table id="thope" style="width: 100%;">
                <tr>
                    <td align="center">
                        <div id="g" style=" position: relative; background-color: green; width: 400px;height: 400;">
                            1
                        </div>
                    </td>
                    <td align="center">                        
                        <div id="h" style=" position: relative; background-color: blue; width: 400px;height: 400;">
                            2
                        </div>
                    </td>
                    <td align="center">
                        <div id="ii" style=" position: relative; background-color: blue; width: 400px;height: 400;">
                            3
                        </div>
                    </td>
                    <td align="center">                         
                        <div id="jj" style=" position: relative; background-color: blue; width: 400px;height: 400;">
                            4
                        </div>
                    </td>

                    <td align="center">                       
                        <div id="kk" style=" position: relative; background-color: blue; width: 400px;height: 400;">
                            5
                        </div>
                    </td>
                    <td align="center">                       
                        <div style=" position: relative; background-color: white; width: 400px;height: 400;">
                            6
                        </div>                                          
                    </td>
                </tr>
            </table> 
        </div>
        <div id="hope" style="  visibility: hidden; position: relative;  background-color: purple; width: 100%;"> </div>
     </div>

     <div id="titik" style=" width: 100%;  vertical-align: top;  text-align: center; height: 5%;"> </div>

    <script>
        var i=0;
        var timer = null;
        elemst = document.getElementById("awak");
        var poscawal = 0; 
        var dtakhir = 1; 
        var dtujuan = 0; 
            elemst.addEventListener('scroll', function() {
            if(i==0){ poscawal = elemst.scrollLeft; }
                i++;
                if(timer !== null) {  clearTimeout(timer); }
                timer = setTimeout(function() { 
                        if( poscawal > 0 ){
                        //alert(" sc awal "+ poscawal +" sc akhir"+elemst.scrollLeft); 
                        ketarik();
                        }poscawal=0; 
                    i=0;
                }, 250);
            }, false);

            function dt(s) {
                let bef = s.split("-"); 
                if (dtakhir > bef[1]) {
                    mode = 'mundur';
                } else {
                    mode = 'maju';
                }
                dtujuan = s;
                el = document.getElementById(s + "s");
                elm = document.getElementById("d-" + dtakhir);
                elm.style.backgroundColor = "#bbb";
                let ss = s.split("-");

                elll = document.getElementById(s);
                elll.style.backgroundColor = "black";
                dtakhir = ss[1];

                pan = document.getElementById("awak");
                pan.scrollLeft = panellen * (ss[1] - 1); 
                //ketarik(); 
            }

            function makeDot() {
                el = document.getElementById("titik");
                ell = document.getElementById("awak");
                elll = document.getElementById("panel");
        
                var cell = document.getElementById('thope').rows[0].cells[1].offsetWidth ; 
                panellen = (ell.clientWidth);
                for (i = 1; i <= Math.ceil( (cell * 5) / ell.clientWidth); i++) {   
                    
                    el.innerHTML = el.innerHTML + " <div class='dot' id='d-"+i+"' onclick=dt('d-"+i+"') ></div>&nbsp; ";
                }
                elll.style.width = ((Math.ceil((400 * 5) / ell.clientWidth)) * 100) + "%"; 
            }
            
            makeDot();
    </script>
 </body> 
</html>
